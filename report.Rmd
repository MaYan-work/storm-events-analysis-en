---
title: "Assignment 4 ETC5513"
author: "XXXX"
output:
  pdf_document:
    citation_package: natbib
    highlight: tango
    number_sections: yes
    toc: yes
    toc_depth: 2
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '2'
bibliography: references.bib 
biblio-style: dinat
subtitle: Team name
header-includes:
- \usepackage{titling}
- \pretitle{\begin{center} 
  \includegraphics[width=5in,height=6in]{Images/sam-albury-oA7MMRxTVzo-unsplash.jpg}\LARGE\\}
- \posttitle{\end{center}}
- \usepackage{fontawesome}
- \usepackage[most]{tcolorbox}
- \usepackage{xcolor}
- \usepackage{sectsty}
- \sectionfont{\color{blue}}
- \usepackage{verbatim}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
---

```{r setup}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning= FALSE)
```

```{r libraries}
library(tidyverse)
library(knitr)
library(readr)
library(lubridate)
library(bookdown)
theme_set(theme_minimal())
```

```{r cleaning-data}
# read data
storm17 <- read_csv("data/StormEvents_details-ftp_v1.0_d2017_c20200121.csv")
storm18 <- read_csv("data/StormEvents_details-ftp_v1.0_d2018_c20200317.csv")
storm19 <- read_csv("data/StormEvents_details-ftp_v1.0_d2019_c20200516.csv")

# change date format
clean <- function(x) {
x$BEGIN_DATE_TIME <- dmy_hms(x$BEGIN_DATE_TIME) 
x$END_DATE_TIME <- dmy_hms(x$END_DATE_TIME)
x$BEGIN_DAY <- mday(x$BEGIN_DATE_TIME)
x$END_DAY <- mday(x$END_DATE_TIME)
x$BEGIN_TIME <- format(as.POSIXct(x$BEGIN_DATE_TIME) ,format = "%H:%M:%S") 
x$END_TIME <- format(as.POSIXct(x$END_DATE_TIME) ,format = "%H:%M:%S") 
x$MONTH_NAME <- month(x$BEGIN_DATE_TIME, label=TRUE)

#unselect column with NA value; unselect BEGIN MONTH and END MONTH because there are already MONTH column
x <- x %>% select(-BEGIN_YEARMONTH, -END_YEARMONTH, -EPISODE_ID, -WFO, -CZ_TIMEZONE, -SOURCE, -MAGNITUDE_TYPE,-CATEGORY, -FLOOD_CAUSE,-TOR_OTHER_WFO,- TOR_OTHER_CZ_STATE, -TOR_OTHER_CZ_FIPS, - TOR_OTHER_CZ_NAME, - BEGIN_AZIMUTH, -BEGIN_LOCATION, -END_AZIMUTH, -END_LOCATION, -EPISODE_NARRATIVE, -EVENT_NARRATIVE, -DATA_SOURCE) 
}

storm17 <- clean(storm17)
storm18 <- clean(storm18)
storm19 <- clean(storm19)
storm_all <- rbind(storm17,storm18,storm19)
```

\clearpage

# Introduction

\clearpage

# Methodology

\clearpage

# Section 1


\clearpage

# Section 2


\clearpage

# Section 3

## The trend of occurence of the event changing by year in each state

In this section, the main purpose is to explore the trend of occurence of the top 5 frequent events changing by year both across the whole USA and in each state. First, create a table and group the data by "STATE" and "YEAR". Then count the times of occurence for all events and rename the name of this column as "FREQ" to present the frequency. And next, create a new table to arrange the data by descending order with displaying the top 5 events that happen most frequently. Then, use "right_join" to connect these two tables. Finally, create two figures to display the trend of occurence of the top 5 event changing by year.
```{r frequencytrend}
storm_frequency_state <- storm_all %>%
  group_by(STATE, YEAR) %>%
  count(EVENT_TYPE) %>%
  rename(FREQ = n) 
```

```{r frequencytrendnew}
storm_frequency_state_new <- storm_all %>%
  group_by(EVENT_TYPE) %>%
  count(EVENT_TYPE) %>%
  rename(FREQ = n) %>%
  arrange(desc(FREQ))%>%
  head(5) %>%
  select(EVENT_TYPE)
```

```{r topnewtable}
top5_newtable <- right_join(storm_frequency_state, storm_frequency_state_new, by = "EVENT_TYPE") %>%
  group_by(STATE)
```

```{r  frequencyplot,fig.height = 30, fig.width= 30}
ggplot(top5_newtable,
       aes(x= YEAR, 
           y = FREQ, group = EVENT_TYPE, color = EVENT_TYPE)) +
  geom_line() +
  scale_y_log10() +
  theme(
  legend.title = element_text(color = "blue", size = 60),
  legend.text = element_text(color = "green", size = 60)
  )
```

```{r  frequencyplot2,fig.width= 25, fig.height= 35}
ggplot(top5_newtable,
       aes(x= YEAR, 
           y = FREQ, group = EVENT_TYPE, color = EVENT_TYPE)) +
  geom_line() +
  facet_wrap(~STATE) +
  scale_y_log10() +
  theme(
  legend.title = element_text(color = "blue", size = 60),
  legend.text = element_text(color = "green", size = 60)
  )
```

\clearpage

# Section 4

\clearpage

# Conclusion

\clearpage

# Citation examples

[More styles for natbib here](https://www.overleaf.com/learn/latex/Natbib_bibliography_styles)


 @BC64 and this is another article about COVID @bai2020presumed and I can also cite R packages as follows @ggplot2
